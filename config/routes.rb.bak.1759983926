# config/routes.rb
Rails.application.routes.draw do
  authenticate :user, lambda { |u| u.admin? } do
    mount Sidekiq::Web => "/ops/sidekiq"
    namespace :ops do
      get "dashboard", to: "dashboard#index"
      get "dashboard.csv", to: "dashboard#csv"
      post "requeue", to: "dashboard#requeue"
    end
  end
  # existing health
  get "/health", to: "health#index"

  # --- ATR admin (namespace) ---
  namespace :atr do
    get  "admin",       to: "admin#index",        as: :admin
    post "admin/run",   to: "admin#run",          as: :admin_run
    post "admin/reset", to: "admin#reset_cursor", as: :admin_reset_cursor
    get  "ping",        to: "admin#ping"

    # /atr/admin/ops -> Atr::Admin::OpsController#index
    namespace :admin do
      get :ops, to: "ops#index"
    end
  end

  # --- Safety alias (some proxies prefer explicit top-level path) ---
  # /atr/admin -> Atr::AdminController#index
  get "/atr/admin",     to: "atr/admin#index"
  get "/atr/admin/ops", to: "atr/admin/ops#index"  # <-- 명시적 별칭 추가
  get "/atr/ping",      to: "atr/admin#ping"

  # ATR Admin Status
  get  "atr/admin/status",         to: "atr/admin#status"
  get  "atr/admin/status/data",    to: "atr/admin#status_data"
  post "atr/admin/status/reindex", to: "atr/admin#reindex"
end
