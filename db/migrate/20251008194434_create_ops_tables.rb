class CreateOpsTables < ActiveRecord::Migration[7.1]\n  def change\n    create_table :posts_metrics, id: false do |t|\n      t.bigint :post_id, primary_key: true\n      t.integer :words\n      t.integer :reading_time_sec\n      t.integer :images\n      t.string :ops_version\n      t.timestamps\n    end\n\n    create_table :ga4_scores, id: false do |t|\n      t.bigint :post_id\n      t.integer :window\n      t.integer :pv\n      t.integer :engagement_sec\n      t.float :ctr\n      t.float :trend\n      t.float :score\n      t.boolean :has_enough_data, default: false\n      t.string :ops_version\n      t.timestamps\n    end\n    add_index :ga4_scores, [:post_id, :window], unique: true\n\n    create_table :posts_ops_states, id: false do |t|\n      t.bigint :post_id, primary_key: true\n      t.string :ops_version_global\n      t.string :last_step\n      t.datetime :last_success_at\n      t.timestamps\n    end\n\n    create_table :posts_ops_steps do |t|\n      t.bigint :post_id\n      t.string :step\n      t.string :version_applied\n      t.datetime :applied_at\n      t.timestamps\n    end\n    add_index :posts_ops_steps, [:post_id, :step], unique: true\n\n    create_table :indexing_submissions do |t|\n      t.string :url\n      t.string :engine\n      t.string :status\n      t.datetime :last_response_at\n      t.string :evidence_uri\n      t.timestamps\n    end\n\n    create_table :ad_match_logs do |t|\n      t.bigint :post_id\n      t.string :merchant\n      t.string :position\n      t.string :decision\n      t.string :reason\n      t.datetime :applied_at\n      t.timestamps\n    end\n  end\nend\n\n