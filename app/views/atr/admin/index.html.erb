<div style="max-width:960px;margin:24px auto;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;">
  <h1 style="margin-bottom:16px;">ATR Runner Admin</h1>

  <% if flash[:notice] %>
    <div style="padding:10px;border:1px solid #cce5cc;background:#eaffea;margin-bottom:12px;"><%= flash[:notice] %></div>
  <% end %>
  <% if flash[:alert] %>
    <div style="padding:10px;border:1px solid #f5c2c7;background:#ffecec;margin-bottom:12px;"><%= flash[:alert] %></div>
  <% end %>

  <section style="margin-bottom:20px;">
    <h3>State</h3>
    <table style="width:100%;border-collapse:collapse;">
      <tbody>
        <tr><th style="text-align:left;width:180px;padding:6px;border-bottom:1px solid #eee;">cursor_offset</th><td style="padding:6px;border-bottom:1px solid #eee;"><%= @state[:cursor_offset] %></td></tr>
        <tr><th style="text-align:left;padding:6px;border-bottom:1px solid #eee;">last_tick_at</th><td style="padding:6px;border-bottom:1px solid #eee;"><%= @state[:last_tick_at] %></td></tr>
        <tr><th style="text-align:left;padding:6px;border-bottom:1px solid #eee;">last_post_id</th><td style="padding:6px;border-bottom:1px solid #eee;"><%= @state[:last_post_id] %></td></tr>
        <tr><th style="text-align:left;padding:6px;border-bottom:1px solid #eee;">processed_total</th><td style="padding:6px;border-bottom:1px solid #eee;"><%= @state[:processed_total] %></td></tr>
        <tr><th style="text-align:left;padding:6px;border-bottom:1px solid #eee;">last_error</th><td style="padding:6px;border-bottom:1px solid #eee;"><pre style="margin:0;white-space:pre-wrap;"><%= @state[:last_error] %></pre></td></tr>
        <tr><th style="text-align:left;padding:6px;border-bottom:1px solid #eee;">last_result</th><td style="padding:6px;border-bottom:1px solid #eee;"><pre style="margin:0;white-space:pre-wrap;"><%= @state[:last_result] %></pre></td></tr>
      </tbody>
    </table>
  </section>

  <section style="margin-bottom:20px;">
    <%= button_to "Run tick once", atr_admin_run_path, method: :post, form: { style: "display:inline" }, class: "btn" %>
    <%= button_to "Reset cursor to 0", atr_admin_reset_cursor_path, method: :post, form: { style: "display:inline;margin-left:8px" }, data: { turbo_confirm: "Reset cursor to 0?" } %>
    <a href="<%= atr_admin_path %>" style="margin-left:8px;">Refresh</a>
  </section>

  <section style="margin-bottom:20px;">
    <h3>Log Tail (200 lines)</h3>
    <pre style="background:#111;color:#ddd;padding:12px;border-radius:6px;max-height:420px;overflow:auto;"><%= @log_tail %></pre>
  </section>

  <section>
    <h3>/etc/cron.d/atr_runner</h3>
    <pre style="background:#f7f7f7;padding:12px;border-radius:6px;"><%= @cron_line || "(no cron file or not readable)" %></pre>
  </section>
</div>
