module Analytics\n  class Ga4PullWorker\n    include Sidekiq::Worker\n    sidekiq_options queue: :analytics\n    def perform(post_id)\n      p = Post.find(post_id)\n      client = GA4Client.new(property_id: ENV["GA4_PROPERTY_ID"])\n      path = URI.parse(p.canonical_url).path\n      data = client.report(start_date: 7.days.ago.to_date, end_date: Date.today, page_paths: [path])\n      Ga4Score.upsert!(post_id: p.id, window: 7, pv: 0, engagement_sec: 0, ctr: 0, trend: 0, score: nil, has_enough_data: false)\n      PostsOpsStep.upsert_step(post_id: p.id, step: 'ga4_pull', version: '1.3.1')\n    end\n  end\nend\n\n