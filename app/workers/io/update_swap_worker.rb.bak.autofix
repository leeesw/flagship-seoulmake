module Io\n  class UpdateSwapWorker\n    include Sidekiq::Worker\n    sidekiq_options queue: :io\n    def perform(new_post_id)\n      np = Post.find(new_post_id)\n      return unless np.title&.include?("[최신]")\n      base_title = np.title.sub(/\s*\[최신\]\s*$/, '')\n      op = Post.published.find_by(title: base_title)\n      return unless op\n      return if np.content_hash == op.content_hash\n      op.update!(content_html: np.content_html, content_hash: np.content_hash)\n      np.update!(status: 'trash')\n      PostsOpsStep.upsert_step(post_id: op.id, step: 'update_swap', version: '1.0.0')\n    end\n  end\nend\n\n