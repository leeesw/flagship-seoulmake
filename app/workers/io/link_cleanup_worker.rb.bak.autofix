module Io\n  class LinkCleanupWorker\n    include Sidekiq::Worker\n    sidekiq_options queue: :io\n    def perform(post_id)\n      p = Post.find(post_id)\n      return unless p.post_type == 'post'\n      cleaned = LinkCleaner.clean_html(p.content_html, base_url: ENV["WP_BASE_URL"], post_only: true)\n      return if cleaned.strip == p.content_html.strip\n      p.update!(content_html: cleaned)\n      PostsOpsStep.upsert_step(post_id: p.id, step: 'link_cleanup', version: '1.2.0')\n    end\n  end\nend\n\n