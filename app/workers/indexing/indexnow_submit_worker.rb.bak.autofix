module Indexing\n  class IndexnowSubmitWorker\n    include Sidekiq::Worker\n    sidekiq_options queue: :indexing\n    def perform(post_id)\n      p = Post.find(post_id)\n      client = IndexNowClient.new(host: URI.parse(p.canonical_url).host, key: ENV["INDEXNOW_KEY"], key_location: ENV["INDEXNOW_KEY_LOCATION"])\n      resp = client.submit(urls: [p.canonical_url])\n      IndexingSubmission.create!(url: p.canonical_url, engine: 'indexnow', status: resp&.code || 'ERR')\n    end\n  end\nend\n\n