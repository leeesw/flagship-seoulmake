class LinkCleaner\n  INTERNAL_HOSTS = [\n    "seoulmake.com",\n    "www.seoulmake.com",\n    "blue.seoulmake.com",\n    "green.seoulmake.com"\n  ].freeze\n\n  PRESERVE_SELECTORS = [\n    'iframe', 'script', '[data-atr-preserve="1"]'\n  ].freeze\n\n  def self.clean_html(html, base_url:, post_only: true)\n    doc = Nokogiri::HTML::fragment(html)\n\n    doc.css('a').each do |a|\n      href = a['href']\n      next unless href\n      begin\n        host = URI.parse(URI.join(base_url, href).to_s).host\n      rescue\n        next\n      end\n      next if host.nil? || INTERNAL_HOSTS.include?(host)\n      next if a.ancestors.any? { |anc| PRESERVE_SELECTORS.any? { |sel| anc.matches?(sel) } }\n\n      a.replace(a.text)\n    end\n\n    doc.to_html\n  end\nend\n\n